@page "/watchlist"
@using Stocks.Shared
@using System.Security.Claims
@inject HttpClient _httpClient
@inject AuthenticationStateProvider _authenticationStateProvider

<Stocks.Client.Components.TickerList Tickers="TickerList"  ActionText="Remove from watchlist" ActionClass="btn btn-outline-danger" ActionCallback="@RemoveFromWatchListAsync"/>

@code {

    public Stocks.Shared.Models.Ticker[] TickerList { get; set; }

    protected override async Task OnInitializedAsync()
    {
        var authState = await _authenticationStateProvider.GetAuthenticationStateAsync();
        var user = authState.User;
        if (user.Identity.IsAuthenticated)
        {
            var claim = user.FindFirst(c => c.Type == ClaimTypes.NameIdentifier);
            var value = claim?.Value;
            var uri = $"/api/watchlist/{value}";
            TickerList = await _httpClient.GetFromJsonAsync<Stocks.Shared.Models.Ticker[]>(uri);
        }
    }

    private async Task RemoveFromWatchListAsync(string tickername)
    {
    }

}
